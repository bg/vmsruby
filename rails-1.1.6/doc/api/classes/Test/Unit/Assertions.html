<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>Module: Test::Unit::Assertions</title>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />

    <script language="JavaScript" type="text/javascript">
    // <![CDATA[

        function toggleSource( id )
        {
          var elem
          var link

          if( document.getElementById )
          {
            elem = document.getElementById( id )
            link = document.getElementById( "l_" + id )
          }
          else if ( document.all )
          {
            elem = eval( "document.all." + id )
            link = eval( "document.all.l_" + id )
          }
          else
            return false;

          if( elem.style.display == "block" )
          {
            elem.style.display = "none"
            link.innerHTML = "show source"
          }
          else
          {
            elem.style.display = "block"
            link.innerHTML = "hide source"
          }
        }

        function openCode( url )
        {
          window.open( url, "SOURCE_CODE", "width=400,height=400,scrollbars=yes" )
        }
      // ]]>
    </script>
  </head>

  <body>
  <table width="100%" border='0' cellpadding='0' cellspacing='0' class='banner'><tr>
  <td class="file-title"><span class="file-title-prefix">Module</span><br />Test::Unit::Assertions</td>
  <td align="right">
    <table cellspacing=0 cellpadding=2>
      <tr valign="top">
        <td>In:</td>
        <td>
<a href="../../../files/vendor/rails/actionpack/lib/action_controller/assertions_rb.html">vendor/rails/actionpack/lib/action_controller/assertions.rb</a>
<a href="../../../files/vendor/rails/actionpack/lib/action_controller/deprecated_assertions_rb.html">vendor/rails/actionpack/lib/action_controller/deprecated_assertions.rb</a>
        </td>
      </tr>
         </table>
        </td>
        </tr>
      </table>
 <!-- banner header -->

  <div id="bodyContent">
      <div id="content">

  <div class="description"><p>
In addition to these specific assertions, you also have easy access to
various collections that the regular test/unit assertions can be used
against. These collections are:
</p>
<ul>
<li>assigns: Instance variables assigned in the action that are available for
the view.

</li>
<li>session: Objects being saved in the session.

</li>
<li>flash: The flash objects currently in the session.

</li>
<li>cookies: Cookies being sent to the user on this request.

</li>
</ul>
<p>
These collections can be used just like any other hash:
</p>
<pre>
  assert_not_nil assigns(:person) # makes sure that a @person instance variable was set
  assert_equal &quot;Dave&quot;, cookies[:name] # makes sure that a cookie called :name was set as &quot;Dave&quot;
  assert flash.empty? # makes sure that there's nothing in the flash
</pre>
<p>
For historic reasons, the assigns hash uses string-based keys. So
assigns[:person] won&#8217;t work, but assigns[&quot;person&quot;] will. To
appease our yearning for symbols, though, an alternative accessor has been
deviced using a method call instead of index referencing. So
assigns(:person) will work just like assigns[&quot;person&quot;], but
again, assigns[:person] will not work.
</p>
<p>
On top of the collections, you have the complete url that a given action
redirected to available in redirect_to_url.
</p>
<p>
For redirects within the same controller, you can even call follow_redirect
and the redirect will be followed, triggering another action call which can
then be asserted against.
</p>
<h2>Manipulating the request collections</h2>
<p>
The collections described above link to the response, so you can test if
what the actions were expected to do happened. But sometimes you also want
to manipulate these collections in the incoming request. This is really
only relevant for sessions and cookies, though. For sessions, you just do:
</p>
<pre>
  @request.session[:key] = &quot;value&quot;
</pre>
<p>
For cookies, you need to manually create the cookie, like this:
</p>
<pre>
  @request.cookies[&quot;key&quot;] = CGI::Cookie.new(&quot;key&quot;, &quot;value&quot;)
</pre>
<h2>Testing named routes</h2>
<p>
If you&#8217;re using named routes, they can be easily tested using the
original named routes methods straight in the test case. Example:
</p>
<pre>
 assert_redirected_to page_url(:title =&gt; 'foo')
</pre>
</div>



  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="#M000972">assert_dom_equal</a></li>
  <li><a href="#M000973">assert_dom_not_equal</a></li>
  <li><a href="#M000968">assert_generates</a></li>
  <li><a href="#M000971">assert_no_tag</a></li>
  <li><a href="#M000967">assert_recognizes</a></li>
  <li><a href="#M000965">assert_redirected_to</a></li>
  <li><a href="#M000964">assert_response</a></li>
  <li><a href="#M000969">assert_routing</a></li>
  <li><a href="#M000970">assert_tag</a></li>
  <li><a href="#M000966">assert_template</a></li>
  <li><a href="#M000974">assert_valid</a></li>
  <li><a href="#M000975">clean_backtrace</a></li>
  </ul>






<div class="sectiontitle">Public Instance methods</div>
<div class="method">
  <div class="title">
    <a name="M000972"></a><b>assert_dom_equal</b>(expected, actual, message=&quot;&quot;)
  </div>
  <div class="description">
  <p>
test 2 html strings to be equivalent, i.e. identical up to reordering of
attributes
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000972_source')" id="l_M000972_source">show source</a> ]</p>
  <div id="M000972_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/actionpack/lib/action_controller/assertions.rb, line 286</span>
286:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">assert_dom_equal</span>(<span class="ruby-identifier">expected</span>, <span class="ruby-identifier">actual</span>, <span class="ruby-identifier">message</span>=<span class="ruby-value str">&quot;&quot;</span>)
287:         <span class="ruby-identifier">clean_backtrace</span> <span class="ruby-keyword kw">do</span>
288:           <span class="ruby-identifier">expected_dom</span> = <span class="ruby-constant">HTML</span><span class="ruby-operator">::</span><span class="ruby-constant">Document</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">expected</span>).<span class="ruby-identifier">root</span>
289:           <span class="ruby-identifier">actual_dom</span> = <span class="ruby-constant">HTML</span><span class="ruby-operator">::</span><span class="ruby-constant">Document</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">actual</span>).<span class="ruby-identifier">root</span>
290:           <span class="ruby-identifier">full_message</span> = <span class="ruby-identifier">build_message</span>(<span class="ruby-identifier">message</span>, <span class="ruby-value str">&quot;&lt;?&gt; expected to be == to\n&lt;?&gt;.&quot;</span>, <span class="ruby-identifier">expected_dom</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">actual_dom</span>.<span class="ruby-identifier">to_s</span>)
291:           <span class="ruby-identifier">assert_block</span>(<span class="ruby-identifier">full_message</span>) { <span class="ruby-identifier">expected_dom</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">actual_dom</span> }
292:         <span class="ruby-keyword kw">end</span>
293:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000973"></a><b>assert_dom_not_equal</b>(expected, actual, message=&quot;&quot;)
  </div>
  <div class="description">
  <p>
negated form of <tt>assert_dom_equivalent</tt>
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000973_source')" id="l_M000973_source">show source</a> ]</p>
  <div id="M000973_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/actionpack/lib/action_controller/assertions.rb, line 296</span>
296:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">assert_dom_not_equal</span>(<span class="ruby-identifier">expected</span>, <span class="ruby-identifier">actual</span>, <span class="ruby-identifier">message</span>=<span class="ruby-value str">&quot;&quot;</span>)
297:         <span class="ruby-identifier">clean_backtrace</span> <span class="ruby-keyword kw">do</span>
298:           <span class="ruby-identifier">expected_dom</span> = <span class="ruby-constant">HTML</span><span class="ruby-operator">::</span><span class="ruby-constant">Document</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">expected</span>).<span class="ruby-identifier">root</span>
299:           <span class="ruby-identifier">actual_dom</span> = <span class="ruby-constant">HTML</span><span class="ruby-operator">::</span><span class="ruby-constant">Document</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">actual</span>).<span class="ruby-identifier">root</span>
300:           <span class="ruby-identifier">full_message</span> = <span class="ruby-identifier">build_message</span>(<span class="ruby-identifier">message</span>, <span class="ruby-value str">&quot;&lt;?&gt; expected to be != to\n&lt;?&gt;.&quot;</span>, <span class="ruby-identifier">expected_dom</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">actual_dom</span>.<span class="ruby-identifier">to_s</span>)
301:           <span class="ruby-identifier">assert_block</span>(<span class="ruby-identifier">full_message</span>) { <span class="ruby-identifier">expected_dom</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">actual_dom</span> }
302:         <span class="ruby-keyword kw">end</span>
303:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000968"></a><b>assert_generates</b>(expected_path, options, defaults={}, extras = {}, message=nil)
  </div>
  <div class="description">
  <p>
Asserts that the provided options can be used to generate the provided
path.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000968_source')" id="l_M000968_source">show source</a> ]</p>
  <div id="M000968_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/actionpack/lib/action_controller/assertions.rb, line 145</span>
145:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">assert_generates</span>(<span class="ruby-identifier">expected_path</span>, <span class="ruby-identifier">options</span>, <span class="ruby-identifier">defaults</span>={}, <span class="ruby-identifier">extras</span> = {}, <span class="ruby-identifier">message</span>=<span class="ruby-keyword kw">nil</span>)
146:         <span class="ruby-identifier">clean_backtrace</span> <span class="ruby-keyword kw">do</span> 
147:           <span class="ruby-identifier">expected_path</span> = <span class="ruby-node">&quot;/#{expected_path}&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">expected_path</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-value">?/</span>
148:           <span class="ruby-comment cmt"># Load routes.rb if it hasn't been loaded.</span>
149:           <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Routing</span><span class="ruby-operator">::</span><span class="ruby-constant">Routes</span>.<span class="ruby-identifier">reload</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Routing</span><span class="ruby-operator">::</span><span class="ruby-constant">Routes</span>.<span class="ruby-identifier">empty?</span> 
150:       
151:           <span class="ruby-identifier">generated_path</span>, <span class="ruby-identifier">extra_keys</span> = <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Routing</span><span class="ruby-operator">::</span><span class="ruby-constant">Routes</span>.<span class="ruby-identifier">generate</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">extras</span>)
152:           <span class="ruby-identifier">found_extras</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">reject</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span> <span class="ruby-identifier">extra_keys</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">k</span>}
153: 
154:           <span class="ruby-identifier">msg</span> = <span class="ruby-identifier">build_message</span>(<span class="ruby-identifier">message</span>, <span class="ruby-value str">&quot;found extras &lt;?&gt;, not &lt;?&gt;&quot;</span>, <span class="ruby-identifier">found_extras</span>, <span class="ruby-identifier">extras</span>)
155:           <span class="ruby-identifier">assert_block</span>(<span class="ruby-identifier">msg</span>) { <span class="ruby-identifier">found_extras</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">extras</span> }
156:       
157:           <span class="ruby-identifier">msg</span> = <span class="ruby-identifier">build_message</span>(<span class="ruby-identifier">message</span>, <span class="ruby-value str">&quot;The generated path &lt;?&gt; did not match &lt;?&gt;&quot;</span>, <span class="ruby-identifier">generated_path</span>, 
158:               <span class="ruby-identifier">expected_path</span>)
159:           <span class="ruby-identifier">assert_block</span>(<span class="ruby-identifier">msg</span>) { <span class="ruby-identifier">expected_path</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">generated_path</span> }
160:         <span class="ruby-keyword kw">end</span>
161:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000971"></a><b>assert_no_tag</b>(*opts)
  </div>
  <div class="description">
  <p>
Identical to <a href="Assertions.html#M000970">assert_tag</a>, but asserts
that a matching tag does <em>not</em> exist. (See <a
href="Assertions.html#M000970">assert_tag</a> for a full discussion of the
syntax.)
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000971_source')" id="l_M000971_source">show source</a> ]</p>
  <div id="M000971_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/actionpack/lib/action_controller/assertions.rb, line 277</span>
277:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">assert_no_tag</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">opts</span>)
278:         <span class="ruby-identifier">clean_backtrace</span> <span class="ruby-keyword kw">do</span>
279:           <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">merge</span>({ <span class="ruby-identifier">:tag</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">to_s</span> }) <span class="ruby-operator">:</span> <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">first</span>
280:           <span class="ruby-identifier">tag</span> = <span class="ruby-identifier">find_tag</span>(<span class="ruby-identifier">opts</span>)
281:           <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">tag</span>, <span class="ruby-node">&quot;expected no tag, but found tag matching #{opts.inspect} in:\n#{@response.body.inspect}&quot;</span>
282:         <span class="ruby-keyword kw">end</span>
283:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000967"></a><b>assert_recognizes</b>(expected_options, path, extras={}, message=nil)
  </div>
  <div class="description">
  <p>
Asserts that the routing of the given path was handled correctly and that
the parsed options match.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000967_source')" id="l_M000967_source">show source</a> ]</p>
  <div id="M000967_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/actionpack/lib/action_controller/assertions.rb, line 123</span>
123:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">assert_recognizes</span>(<span class="ruby-identifier">expected_options</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">extras</span>={}, <span class="ruby-identifier">message</span>=<span class="ruby-keyword kw">nil</span>)
124:         <span class="ruby-identifier">clean_backtrace</span> <span class="ruby-keyword kw">do</span> 
125:           <span class="ruby-identifier">path</span> = <span class="ruby-node">&quot;/#{path}&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">path</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">'/'</span>
126:           <span class="ruby-comment cmt"># Load routes.rb if it hasn't been loaded.</span>
127:           <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Routing</span><span class="ruby-operator">::</span><span class="ruby-constant">Routes</span>.<span class="ruby-identifier">reload</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Routing</span><span class="ruby-operator">::</span><span class="ruby-constant">Routes</span>.<span class="ruby-identifier">empty?</span> 
128:       
129:           <span class="ruby-comment cmt"># Assume given controller</span>
130:           <span class="ruby-identifier">request</span> = <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">TestRequest</span>.<span class="ruby-identifier">new</span>({}, {}, <span class="ruby-keyword kw">nil</span>)
131:           <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path</span> = <span class="ruby-identifier">path</span>
132:           <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Routing</span><span class="ruby-operator">::</span><span class="ruby-constant">Routes</span>.<span class="ruby-identifier">recognize!</span>(<span class="ruby-identifier">request</span>)
133:       
134:           <span class="ruby-identifier">expected_options</span> = <span class="ruby-identifier">expected_options</span>.<span class="ruby-identifier">clone</span>
135:           <span class="ruby-identifier">extras</span>.<span class="ruby-identifier">each_key</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span> <span class="ruby-identifier">expected_options</span>.<span class="ruby-identifier">delete</span> <span class="ruby-identifier">key</span> } <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">extras</span>.<span class="ruby-identifier">nil?</span>
136:       
137:           <span class="ruby-identifier">expected_options</span>.<span class="ruby-identifier">stringify_keys!</span>
138:           <span class="ruby-identifier">msg</span> = <span class="ruby-identifier">build_message</span>(<span class="ruby-identifier">message</span>, <span class="ruby-value str">&quot;The recognized options &lt;?&gt; did not match &lt;?&gt;&quot;</span>, 
139:               <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path_parameters</span>, <span class="ruby-identifier">expected_options</span>)
140:           <span class="ruby-identifier">assert_block</span>(<span class="ruby-identifier">msg</span>) { <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path_parameters</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">expected_options</span> }
141:         <span class="ruby-keyword kw">end</span>
142:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000965"></a><b>assert_redirected_to</b>(options = {}, message=nil)
  </div>
  <div class="description">
  <p>
Assert that the redirection options passed in match those of the redirect
called in the latest action. This match can be partial, such that <a
href="Assertions.html#M000965">assert_redirected_to</a>(:controller =&gt;
&quot;weblog&quot;) will also match the redirection of
redirect_to(:controller =&gt; &quot;weblog&quot;, :action =&gt;
&quot;show&quot;) and so on.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000965_source')" id="l_M000965_source">show source</a> ]</p>
  <div id="M000965_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/actionpack/lib/action_controller/assertions.rb, line 73</span>
 73:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">assert_redirected_to</span>(<span class="ruby-identifier">options</span> = {}, <span class="ruby-identifier">message</span>=<span class="ruby-keyword kw">nil</span>)
 74:         <span class="ruby-identifier">clean_backtrace</span> <span class="ruby-keyword kw">do</span>
 75:           <span class="ruby-identifier">assert_response</span>(<span class="ruby-identifier">:redirect</span>, <span class="ruby-identifier">message</span>)
 76: 
 77:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
 78:             <span class="ruby-identifier">msg</span> = <span class="ruby-identifier">build_message</span>(<span class="ruby-identifier">message</span>, <span class="ruby-value str">&quot;expected a redirect to &lt;?&gt;, found one to &lt;?&gt;&quot;</span>, <span class="ruby-identifier">options</span>, <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">redirect_url</span>)
 79:             <span class="ruby-identifier">url_regexp</span> = <span class="ruby-regexp re">%r{^(\w+://.*?(/|$|\?))(.*)$}</span>
 80:             <span class="ruby-identifier">eurl</span>, <span class="ruby-identifier">epath</span>, <span class="ruby-identifier">url</span>, <span class="ruby-identifier">path</span> = [<span class="ruby-identifier">options</span>, <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">redirect_url</span>].<span class="ruby-identifier">collect</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">url</span><span class="ruby-operator">|</span>
 81:               <span class="ruby-identifier">u</span>, <span class="ruby-identifier">p</span> = (<span class="ruby-identifier">url_regexp</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">url</span>) <span class="ruby-operator">?</span> [<span class="ruby-identifier">$1</span>, <span class="ruby-identifier">$3</span>] <span class="ruby-operator">:</span> [<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">url</span>]
 82:               [<span class="ruby-identifier">u</span>, (<span class="ruby-identifier">p</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">'/'</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">p</span> <span class="ruby-operator">:</span> <span class="ruby-value str">'/'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p</span>]
 83:             <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">flatten</span>
 84: 
 85:             <span class="ruby-identifier">assert_equal</span>(<span class="ruby-identifier">eurl</span>, <span class="ruby-identifier">url</span>, <span class="ruby-identifier">msg</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">eurl</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">url</span>
 86:             <span class="ruby-identifier">assert_equal</span>(<span class="ruby-identifier">epath</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">msg</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">epath</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">path</span> 
 87:           <span class="ruby-keyword kw">else</span>
 88:             <span class="ruby-ivar">@response_diff</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">diff</span>(<span class="ruby-ivar">@response</span>.<span class="ruby-identifier">redirected_to</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">redirected_to</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)
 89:             <span class="ruby-identifier">msg</span> = <span class="ruby-identifier">build_message</span>(<span class="ruby-identifier">message</span>, <span class="ruby-node">&quot;response is not a redirection to all of the options supplied (redirection is &lt;?&gt;)#{', difference: &lt;?&gt;' if @response_diff}&quot;</span>, 
 90:                                 <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">redirected_to</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">redirect_url</span>, <span class="ruby-ivar">@response_diff</span>)
 91: 
 92:             <span class="ruby-identifier">assert_block</span>(<span class="ruby-identifier">msg</span>) <span class="ruby-keyword kw">do</span>
 93:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Symbol</span>)
 94:                 <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">redirected_to</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">options</span>
 95:               <span class="ruby-keyword kw">else</span>
 96:                 <span class="ruby-identifier">options</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">all?</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span>
 97:                   <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">k</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:controller</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">k</span>] <span class="ruby-operator">==</span> <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Routing</span>.<span class="ruby-identifier">controller_relative_to</span>(<span class="ruby-ivar">@response</span>.<span class="ruby-identifier">redirected_to</span>[<span class="ruby-identifier">k</span>], <span class="ruby-ivar">@controller</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">controller_path</span>)
 98:                   <span class="ruby-keyword kw">else</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">k</span>] <span class="ruby-operator">==</span> (<span class="ruby-ivar">@response</span>.<span class="ruby-identifier">redirected_to</span>[<span class="ruby-identifier">k</span>].<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:to_param</span>) <span class="ruby-operator">?</span> <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">redirected_to</span>[<span class="ruby-identifier">k</span>].<span class="ruby-identifier">to_param</span> <span class="ruby-operator">:</span> <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">redirected_to</span>[<span class="ruby-identifier">k</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">redirected_to</span>[<span class="ruby-identifier">k</span>].<span class="ruby-identifier">nil?</span>)
 99:                   <span class="ruby-keyword kw">end</span>
100:                 <span class="ruby-keyword kw">end</span>
101:               <span class="ruby-keyword kw">end</span>
102:             <span class="ruby-keyword kw">end</span>
103:           <span class="ruby-keyword kw">end</span>
104:         <span class="ruby-keyword kw">end</span>
105:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000964"></a><b>assert_response</b>(type, message = nil)
  </div>
  <div class="description">
  <p>
Asserts that the response is one of the following types:
</p>
<ul>
<li><tt>:success</tt>: Status code was 200

</li>
<li><tt>:redirect</tt>: Status code was in the 300-399 range

</li>
<li><tt>:missing</tt>: Status code was 404

</li>
<li><tt>:error</tt>: Status code was in the 500-599 range

</li>
</ul>
<p>
You can also pass an explicit status code number as the type, like <a
href="Assertions.html#M000964">assert_response</a>(501)
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000964_source')" id="l_M000964_source">show source</a> ]</p>
  <div id="M000964_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/rails/actionpack/lib/action_controller/assertions.rb, line 58</span>
58:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">assert_response</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">message</span> = <span class="ruby-keyword kw">nil</span>)
59:         <span class="ruby-identifier">clean_backtrace</span> <span class="ruby-keyword kw">do</span>
60:           <span class="ruby-keyword kw">if</span> [ <span class="ruby-identifier">:success</span>, <span class="ruby-identifier">:missing</span>, <span class="ruby-identifier">:redirect</span>, <span class="ruby-identifier">:error</span> ].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">type</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;#{type}?&quot;</span>)
61:             <span class="ruby-identifier">assert_block</span>(<span class="ruby-value str">&quot;&quot;</span>) { <span class="ruby-keyword kw">true</span> } <span class="ruby-comment cmt"># to count the assertion</span>
62:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">type</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">response_code</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">type</span>
63:             <span class="ruby-identifier">assert_block</span>(<span class="ruby-value str">&quot;&quot;</span>) { <span class="ruby-keyword kw">true</span> } <span class="ruby-comment cmt"># to count the assertion</span>
64:           <span class="ruby-keyword kw">else</span>
65:             <span class="ruby-identifier">assert_block</span>(<span class="ruby-identifier">build_message</span>(<span class="ruby-identifier">message</span>, <span class="ruby-value str">&quot;Expected response to be a &lt;?&gt;, but was &lt;?&gt;&quot;</span>, <span class="ruby-identifier">type</span>, <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">response_code</span>)) { <span class="ruby-keyword kw">false</span> }
66:           <span class="ruby-keyword kw">end</span>               
67:         <span class="ruby-keyword kw">end</span>
68:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000969"></a><b>assert_routing</b>(path, options, defaults={}, extras={}, message=nil)
  </div>
  <div class="description">
  <p>
Asserts that path and options match both ways; in other words, the URL
generated from options is the same as path, and also that the options
recognized from path are the same as options
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000969_source')" id="l_M000969_source">show source</a> ]</p>
  <div id="M000969_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/actionpack/lib/action_controller/assertions.rb, line 165</span>
165:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">assert_routing</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">options</span>, <span class="ruby-identifier">defaults</span>={}, <span class="ruby-identifier">extras</span>={}, <span class="ruby-identifier">message</span>=<span class="ruby-keyword kw">nil</span>)
166:         <span class="ruby-identifier">assert_recognizes</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">extras</span>, <span class="ruby-identifier">message</span>)
167:         
168:         <span class="ruby-identifier">controller</span>, <span class="ruby-identifier">default_controller</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:controller</span>], <span class="ruby-identifier">defaults</span>[<span class="ruby-identifier">:controller</span>] 
169:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">controller</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">controller</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value">?/</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">default_controller</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">default_controller</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value">?/</span>)
170:           <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:controller</span>] = <span class="ruby-node">&quot;/#{controller}&quot;</span>
171:         <span class="ruby-keyword kw">end</span>
172:          
173:         <span class="ruby-identifier">assert_generates</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">options</span>, <span class="ruby-identifier">defaults</span>, <span class="ruby-identifier">extras</span>, <span class="ruby-identifier">message</span>)
174:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000970"></a><b>assert_tag</b>(*opts)
  </div>
  <div class="description">
  <p>
Asserts that there is a tag/node/element in the body of the response that
meets all of the given conditions. The <tt>conditions</tt> parameter must
be a hash of any of the following keys (all are optional):
</p>
<ul>
<li><tt>:tag</tt>: the node type must match the corresponding value

</li>
<li><tt>:attributes</tt>: a hash. The node&#8217;s attributes must match the
corresponding values in the hash.

</li>
<li><tt>:parent</tt>: a hash. The node&#8217;s parent must match the
corresponding hash.

</li>
<li><tt>:child</tt>: a hash. At least one of the node&#8217;s immediate
children must meet the criteria described by the hash.

</li>
<li><tt>:ancestor</tt>: a hash. At least one of the node&#8217;s ancestors must
meet the criteria described by the hash.

</li>
<li><tt>:descendant</tt>: a hash. At least one of the node&#8217;s descendants
must meet the criteria described by the hash.

</li>
<li><tt>:sibling</tt>: a hash. At least one of the node&#8217;s siblings must
meet the criteria described by the hash.

</li>
<li><tt>:after</tt>: a hash. The node must be after any sibling meeting the
criteria described by the hash, and at least one sibling must match.

</li>
<li><tt>:before</tt>: a hash. The node must be before any sibling meeting the
criteria described by the hash, and at least one sibling must match.

</li>
<li><tt>:children</tt>: a hash, for counting children of a node. Accepts the
keys:

<ul>
<li><tt>:count</tt>: either a number or a range which must equal (or include)
the number of children that match.

</li>
<li><tt>:less_than</tt>: the number of matching children must be less than this
number.

</li>
<li><tt>:greater_than</tt>: the number of matching children must be greater
than this number.

</li>
<li><tt>:only</tt>: another hash consisting of the keys to use to match on the
children, and only matching children will be counted.

</li>
</ul>
</li>
<li><tt>:content</tt>: the textual content of the node must match the

<pre>
  given value. This will not match HTML tags in the body of a
  tag--only text.
</pre>
</li>
</ul>
<p>
Conditions are matched using the following algorithm:
</p>
<ul>
<li>if the condition is a string, it must be a substring of the value.

</li>
<li>if the condition is a regexp, it must match the value.

</li>
<li>if the condition is a number, the value must match number.to_s.

</li>
<li>if the condition is <tt>true</tt>, the value must not be <tt>nil</tt>.

</li>
<li>if the condition is <tt>false</tt> or <tt>nil</tt>, the value must be
<tt>nil</tt>.

</li>
</ul>
<p>
Usage:
</p>
<pre>
  # assert that there is a &quot;span&quot; tag
  assert_tag :tag =&gt; &quot;span&quot;

  # assert that there is a &quot;span&quot; tag with id=&quot;x&quot;
  assert_tag :tag =&gt; &quot;span&quot;, :attributes =&gt; { :id =&gt; &quot;x&quot; }

  # assert that there is a &quot;span&quot; tag using the short-hand
  assert_tag :span

  # assert that there is a &quot;span&quot; tag with id=&quot;x&quot; using the short-hand
  assert_tag :span, :attributes =&gt; { :id =&gt; &quot;x&quot; }

  # assert that there is a &quot;span&quot; inside of a &quot;div&quot;
  assert_tag :tag =&gt; &quot;span&quot;, :parent =&gt; { :tag =&gt; &quot;div&quot; }

  # assert that there is a &quot;span&quot; somewhere inside a table
  assert_tag :tag =&gt; &quot;span&quot;, :ancestor =&gt; { :tag =&gt; &quot;table&quot; }

  # assert that there is a &quot;span&quot; with at least one &quot;em&quot; child
  assert_tag :tag =&gt; &quot;span&quot;, :child =&gt; { :tag =&gt; &quot;em&quot; }

  # assert that there is a &quot;span&quot; containing a (possibly nested)
  # &quot;strong&quot; tag.
  assert_tag :tag =&gt; &quot;span&quot;, :descendant =&gt; { :tag =&gt; &quot;strong&quot; }

  # assert that there is a &quot;span&quot; containing between 2 and 4 &quot;em&quot; tags
  # as immediate children
  assert_tag :tag =&gt; &quot;span&quot;,
             :children =&gt; { :count =&gt; 2..4, :only =&gt; { :tag =&gt; &quot;em&quot; } }

  # get funky: assert that there is a &quot;div&quot;, with an &quot;ul&quot; ancestor
  # and an &quot;li&quot; parent (with &quot;class&quot; = &quot;enum&quot;), and containing a
  # &quot;span&quot; descendant that contains text matching /hello world/
  assert_tag :tag =&gt; &quot;div&quot;,
             :ancestor =&gt; { :tag =&gt; &quot;ul&quot; },
             :parent =&gt; { :tag =&gt; &quot;li&quot;,
                          :attributes =&gt; { :class =&gt; &quot;enum&quot; } },
             :descendant =&gt; { :tag =&gt; &quot;span&quot;,
                              :child =&gt; /hello world/ }
</pre>
<p>
&lt;strong&gt;Please note&lt;/strong: <a
href="Assertions.html#M000970">assert_tag</a> and <a
href="Assertions.html#M000971">assert_no_tag</a> only work with well-formed
XHTML. They recognize a few tags as implicitly self-closing (like br and hr
and such) but will not work correctly with tags that allow optional closing
tags (p, li, td). <em>You must explicitly close all of your tags to use
these assertions.</em>
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000970_source')" id="l_M000970_source">show source</a> ]</p>
  <div id="M000970_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/actionpack/lib/action_controller/assertions.rb, line 267</span>
267:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">assert_tag</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">opts</span>)
268:         <span class="ruby-identifier">clean_backtrace</span> <span class="ruby-keyword kw">do</span>
269:           <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">merge</span>({ <span class="ruby-identifier">:tag</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">to_s</span> }) <span class="ruby-operator">:</span> <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">first</span>
270:           <span class="ruby-identifier">tag</span> = <span class="ruby-identifier">find_tag</span>(<span class="ruby-identifier">opts</span>)
271:           <span class="ruby-identifier">assert</span> <span class="ruby-identifier">tag</span>, <span class="ruby-node">&quot;expected tag, but no tag found matching #{opts.inspect} in:\n#{@response.body.inspect}&quot;</span>
272:         <span class="ruby-keyword kw">end</span>
273:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000966"></a><b>assert_template</b>(expected = nil, message=nil)
  </div>
  <div class="description">
  <p>
Asserts that the request was rendered with the appropriate template file.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000966_source')" id="l_M000966_source">show source</a> ]</p>
  <div id="M000966_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/actionpack/lib/action_controller/assertions.rb, line 108</span>
108:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">assert_template</span>(<span class="ruby-identifier">expected</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">message</span>=<span class="ruby-keyword kw">nil</span>)
109:         <span class="ruby-identifier">clean_backtrace</span> <span class="ruby-keyword kw">do</span>
110:           <span class="ruby-identifier">rendered</span> = <span class="ruby-identifier">expected</span> <span class="ruby-value">? </span><span class="ruby-ivar">@response</span>.<span class="ruby-identifier">rendered_file</span>(<span class="ruby-operator">!</span><span class="ruby-identifier">expected</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">'/'</span>)) <span class="ruby-operator">:</span> <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">rendered_file</span>
111:           <span class="ruby-identifier">msg</span> = <span class="ruby-identifier">build_message</span>(<span class="ruby-identifier">message</span>, <span class="ruby-value str">&quot;expecting &lt;?&gt; but rendering with &lt;?&gt;&quot;</span>, <span class="ruby-identifier">expected</span>, <span class="ruby-identifier">rendered</span>)
112:           <span class="ruby-identifier">assert_block</span>(<span class="ruby-identifier">msg</span>) <span class="ruby-keyword kw">do</span>
113:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">nil?</span>
114:               <span class="ruby-operator">!</span><span class="ruby-ivar">@response</span>.<span class="ruby-identifier">rendered_with_file?</span>
115:             <span class="ruby-keyword kw">else</span>
116:               <span class="ruby-identifier">expected</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">rendered</span>
117:             <span class="ruby-keyword kw">end</span>
118:           <span class="ruby-keyword kw">end</span>               
119:         <span class="ruby-keyword kw">end</span>
120:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000974"></a><b>assert_valid</b>(record)
  </div>
  <div class="description">
  <p>
ensures that the passed record is valid by active record standards. returns
the error messages if not
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000974_source')" id="l_M000974_source">show source</a> ]</p>
  <div id="M000974_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/actionpack/lib/action_controller/assertions.rb, line 306</span>
306:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">assert_valid</span>(<span class="ruby-identifier">record</span>)
307:         <span class="ruby-identifier">clean_backtrace</span> <span class="ruby-keyword kw">do</span>
308:           <span class="ruby-identifier">assert</span> <span class="ruby-identifier">record</span>.<span class="ruby-identifier">valid?</span>, <span class="ruby-identifier">record</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">full_messages</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
309:         <span class="ruby-keyword kw">end</span>
310:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000975"></a><b>clean_backtrace</b>() {|| ...}
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000975_source')" id="l_M000975_source">show source</a> ]</p>
  <div id="M000975_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/rails/actionpack/lib/action_controller/assertions.rb, line 312</span>
312:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">clean_backtrace</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
313:         <span class="ruby-keyword kw">yield</span>
314:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">AssertionFailedError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>         
315:         <span class="ruby-identifier">path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-keyword kw">__FILE__</span>)
316:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">AssertionFailedError</span>, <span class="ruby-identifier">e</span>.<span class="ruby-identifier">message</span>, <span class="ruby-identifier">e</span>.<span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">line</span>) <span class="ruby-operator">=~</span> <span class="ruby-node">/#{path}/</span> }
317:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>

    </body>
</html>